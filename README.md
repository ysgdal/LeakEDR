# LeakEDR â€” EDR Anomaly Detection and Rule Extraction via API Traces

This repository contains the **source code** of the paper  
**LeakEDR: Revealing Behavioral Side Channels in Black-Box EDR via API Traces**.

It trains a language model to learn the *normal behavioral baseline* of an EDR system and detects anomalous API calls in malware execution scenarios. Based on detected anomalies, the system extracts association rules between **malware behaviors** and **EDR abnormal reactions**.

---



1. **Baseline Model Training**
   - Train a GPT2-XL language model on API call sequences generated by EDR during normal execution
   - The model learns the normal behavioral distribution of the EDR

2. **Anomaly Detection**
   - Feed *EDR + Malware* mixed execution API sequences into the baseline model
   - Detect anomalous EDR API calls using Negative Log-Likelihood (NLL)

3. **Rule Extraction**
   - Trace back malware API calls preceding anomalous EDR behavior
   - Build and count association rules: *Malware Behavior â†’ EDR Anomaly*

---

## ðŸ“Š Data and Token Format

### Raw Log Format (JSON)

```json
{
  "TimeStamp": 1234567890.123,
  "ProcessName": "\\Device\\HarddiskVolume2\\Program Files\\Windows Defender\\MsMpEng.exe",
  "Method": "NtOpenKey",
  "Plugin": "syscall",
  "GlobalID": 12345
}
